name: prepare-widgets

on:
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/workflows/prepare-widgets.yml'
      - 'widgets/centreon-widget-engine-status/**'
  push:
    paths:
      - '.github/workflows/prepare-widgets.yml'
      - 'widgets/centreon-widget-engine-status/**'
    tags:
      - centreon-widget-engine-status-22.10.**

env:
  version: "22.10"
  module: "centreon-widget-engine-status"


jobs:
  find-jobs:
    runs-on: [self-hosted, common]
    name: Find Jobs
    container: ubuntu
    outputs:
      folders: ${{ steps.jobs.outputs.folders }}
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 0

      - id: jobs
        uses: philips-labs/list-folder-action@v1
        with:
          path: ./widgets

  matrix:
    runs-on: [self-hosted, common]
    name: Matrix Jobs
    needs: [find-jobs]
    container: ubuntu
    defaults:
      run:
        working-directory: ${{ matrix.folder }}
    strategy:
      matrix:
        folder: ${{ fromJson(needs.find-jobs.outputs.folders )}}
    steps:
      - name: do something
        run: echo ${{ matrix.folder }}
