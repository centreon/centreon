on:
  workflow_call:
    inputs:
      widget_name:
        required: true
        type: string
      major_version:
        required: true
        type: string
      minor_version:
        required: true
        type: string
      release:
        required: true
        type: string
    secrets:
      nexus_username:
        required: true
      nexus_password:
        required: true

jobs:
  package:
#    runs-on: ubuntu-22.04

    strategy:
      fail-fast: false
      matrix:
        distrib: [el7, el8, bullseye]
        include:
          - package_extension: rpm
            image: packaging-centos7
            distrib: el7
          - package_extension: rpm
            image: packaging-alma8
            distrib: el8
          - package_extension: deb
            image: packaging-bullseye
            distrib: bullseye

    uses: ./.github/workflows/package.yml
    with:
      base_directory: widgets/centreon-widget-${{ inputs.widget_name }}
      spec_file: widgets/centreon-widget.spectemplate
      package_extension: ${{ matrix.package_extension }}
      image_name: ${{ matrix.image }}
      module_name: centreon
      major_version: ${{ inputs.major_version }}
      minor_version: ${{ inputs.minor_version }}
      release: ${{ inputs.release }}
      cache_key: ${{ github.sha }}-${{ github.run_id }}-${{ matrix.package_extension }}-${{ matrix.distrib }}
    secrets:
      artifactory_username: ${{ secrets.REPOS_USERNAME }}
      artifactory_password: ${{ secrets.REPOS_PASSWORD }}

#    steps:
#      - name: Checkout sources
#        uses: actions/checkout@v3

#      - uses: ./.github/actions/package
 #       with:
 #         package_extension: ${{ matrix.package_extension }}
#          image_name: ${{ matrix.image }}
#          script_name: widget-packaging-${{ matrix.package_extension }}
#          module_name: widgets/centreon-widget-${{ inputs.widget_name }}
#          major_version: ${{ inputs.major_version }}
#          minor_version: ${{ inputs.minor_version }}
#          release: ${{ inputs.release }}
#          cache_key: ${{ github.sha }}-${{ github.run_id }}-${{ matrix.package_extension }}-${{ matrix.distrib }}
#          sign: true
#          nexus_username: ${{ secrets.nexus_username }}
#          nexus_password: ${{ secrets.nexus_password }}
