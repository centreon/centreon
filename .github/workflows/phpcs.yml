name: phpcs

on:   
  workflow_dispatch:
  pull_request:
    paths:
      - '.github/workflows/centreon.yml'
      - 'centreon/**'
  push:
    branches:
      - develop
    paths:
      - '.github/workflows/centreon.yml'
      - 'centreon/**'
    tags:
      - centreon-22.10.**

env:
  version: "22.10"
  
jobs:
    phpstan-analysis:
      name: phpstan static code analysis and code sniffer
      runs-on: ubuntu-latest
      steps:
          - uses: actions/checkout@v2
          - name: Setup PHP
            uses: shivammathur/setup-php@v1
            with:
                php-version: 8.0
                coverage: none # disable xdebug, pcov
                tools: cs2pr
          - run: |
                cd centreon
                composer install 
                ./vendor/bin/phpcs --report-full -q . --report-checkstyle=./phpcs-report.xml
                cs2pr ./phpcs-report.xml
