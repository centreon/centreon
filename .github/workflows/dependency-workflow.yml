---
name: Centreon Workflow

on:
  workflow_call:
    inputs:
      module_name:
        required: true
        type: string
      image_name:
        required: true
        type: string
      image_version:
        required: true
        type: string

jobs:
  test:
    runs-on: common
    name: Test ${{ inputs.module_name }}-${{ inputs.image_name }}
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3

      - name: Testing ${{ inputs.module_name }} ${{ inputs.image_name }}
        run: docker run -i --entrypoint /src/ci/scripts/${{ inputs.module_name }}-test-${{ inputs.image_name }}.sh -v "$PWD:/src" docker.registry.apps.centreon.com/${{ inputs.module_name }}-test-${{ inputs.image_name }}:${{ inputs.image_version }}

  build:
    runs-on: common
    name: Build ${{ inputs.module_name }}-${{ inputs.package }}
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3

      - name: Building ${{ inputs.module_name }} ${{ inputs.package }}
        run: docker run -i --entrypoint /src/ci/scripts/${{ inputs.module_name }}-build-${{ inputs.package }}.sh -v "$PWD:/src" docker.registry.apps.centreon.com/${{ inputs.module_name }}-build-${{ inputs.package }}:${{ inputs.docker_version }}