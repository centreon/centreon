name: Behat Acceptance Testing
description: Behat Acceptance Testing

inputs:
  project:
    description: project
    required: true
  distrib:
    description: distrib
    required: true
  image_version:
    description: image_version
    required: true
  behat_image_version:
    description: behat_image_version
    default: "22.10"
    required: false
  registry:
    description: registry
    required: false
    default: docker.registry.apps.centreon.com
  registry_username:
    description: registry_username
    required: true
  registry_password:
    description: registry_password
    required: true
  tags:
    description: tags
    required: false
    default: ""
runs:
  using: "composite"

  steps:
    - name: "Run Behat"
      run: docker run --shm-size 6g -e PROJECT="${{ inputs.project }}" -e IMAGE_VERSION="${{ inputs.image_version }}" -e DISTRIB="${{ inputs.distrib }}" -e REGISTRY=${{ inputs.registry }} -e REGISTRY_USERNAME=${{ inputs.registry_username }} -e REGISTRY_PASSWORD=${{ inputs.registry_password }} -e TAGS=${{ inputs.tags }} -v "/dev/shm:/dev/shm" -v "$PWD:/tmp" -v "/var/run/docker.sock:/var/run/docker.sock" -w "/tmp" --entrypoint "/tmp/ci/scripts/behat-acceptance-testing.sh" --net="host" ${{ inputs.registry }}/behat:${{ inputs.behat_image_version }}
      shell: bash
