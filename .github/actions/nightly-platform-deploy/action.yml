name: "nightly platform deploy"
description: "Deploy a platform with packages from nightly builds."
inputs:
  deploy_type:
    description: "The type of platform deployment (install or update)."
    required: false
  ref:
    description: "Reference branch for cod."
    required: true
  bu:
    description: "Business unit to use."
    required: true
  disk_size:
    description: ""
    required: true
  poller_number:
    description: ""
    required: true
  central_instance:
    description: ""
    required: true
  poller_instance:
    description: ""
    required: true
  system_name:
    description: ""
    required: true
  branch:
    description: ""
    required: true
  configured_resources:
    description: ""
    required: true
  install_business_modules:
    description: ""
    required: true
  instance_password:
    description: ""
    required: true
  cod_service_token:
    description: ""
    required: true



runs:
  using: "composite"
  steps:
    - name: Deploy a COD platform with nightly build artifacts
      run: |
          curl -X POST \
          -H "Authorization: Bearer ${{inputs.cod_service_token}}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/centreon/centreon-on-demand/actions/workflows/deploy.yml/dispatches \
          -d '{"ref": "main", "inputs":{"bu":"rd", "disk_size":"${{ inputs.disk_size }}", "poller_number":"${{ inputs.poller_number }}", "central_instance":"${{ inputs.central_instance }}", "poller_instance":"${{ inputs.poller_instance }}", "system_name":"${{ inputs.system_name }}", "centreon_branch":"${{ inputs.centreon_branch }}", "configured_resources":"${{ inputs.configured_resources }}", "install_business_modules":"${{ inputs.install_business_modules }}", "instance_password":"${{ inputs.instance_password }}" }}'
      shell: bash

