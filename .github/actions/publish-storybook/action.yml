name: publish-storybook
description: Publish storybook

inputs:
  major_version:
    description: "Major version"
    required: true
  directory:
    description: "Directory"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@1a4442cacd436585916779262731d5b162bc6ec7 # v3.8.2
      with:
        node-version: 16.2.0

    - name: Build storybook
      run: |
        npm ci --legacy-peer-deps
        npm run build:storybook
      shell: bash
      working-directory: ${{ inputs.directory }}

    - name: Publish ${{ inputs.major_version }} version of the storybook to S3 bucket
      run: |
        TARGETDIR="s3://centreon-storybook/${{ inputs.major_version }}"
        aws s3 rm --recursive "$TARGETDIR"
        aws s3 cp --recursive ".out/" "$TARGETDIR"
      shell: bash
      working-directory: ${{ inputs.directory }}
