name: publish-storybook
description: Publish storybook

inputs:
  major_version:
    description: "Major version"
    required: true
  directory:
    description: "Directory"
    required: true
  centreon_directory:
    description: "Centreon directory"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v3
      with:
        node-version: 16

    - name: Install dependencies
      run: npm ci --legacy-peer-deps
      shell: bash
      working-directory: ${{ inputs.centreon_directory }}

    - name: Build storybook
      run: npm run build:storybook
      shell: bash
      working-directory: ${{ inputs.directory }}

    - name: Publish ${{ inputs.major_version }} version of the storybook to S3 bucket
      run: |
        TARGETDIR="s3://centreon-storybook/${{ inputs.major_version }}"
        aws s3 rm --recursive "$TARGETDIR"
        aws s3 cp --recursive ".out/" "$TARGETDIR"
      shell: bash
      working-directory: ${{ inputs.directory }}