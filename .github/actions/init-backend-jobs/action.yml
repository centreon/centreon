name: 'Init job for backend'
description: 'Composer checkout, install depencies and setup php version'
inputs:
  php-version:
    description: php version to install
    required: true
    default: '8.0'
runs:
  using: 'composite'
  steps:
    - name: Cache Composer
      uses: actions/cache@v2
      id: composer-cache
      with:
        path: centreon/vendor
        key: ${{ runner.os }}-composer-${{ hashFiles('**/composer.lock') }}

    - name: Install composer dependencies
      #if: steps.composer-cache.outputs.cache-hit != 'true'
      run: cd centreon && composer install --prefer-dist --no-progress && composer require staabm/annotate-pull-request-from-checkstyle
      shell: bash

    - name: Setup PHP version
      uses: shivammathur/setup-php@v2
      with:
        php-version: ${{ inputs.php-version }}
