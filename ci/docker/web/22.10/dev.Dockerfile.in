FROM registry.centreon.com/mon-web-22.10:@DISTRIB@

COPY composer.json /usr/share/centreon/composer.json
COPY package.json /usr/share/centreon/package.json
COPY bootstrap.php /usr/share/centreon/bootstrap.php
COPY container.php /usr/share/centreon/container.php
COPY api /usr/share/centreon/api
COPY vendor /usr/share/centreon/vendor
COPY GPL_LIB /usr/share/centreon/GPL_LIB
RUN chown apache:apache /usr/share/centreon/GPL_LIB/SmartyCache/compile
COPY bin /usr/share/centreon/bin
RUN chmod +x /usr/share/centreon/bin/* && sed -i 's#@PHP_BIN@#/usr/bin/php#g' /usr/share/centreon/bin/centreon
COPY www/class /usr/share/centreon/www/class
# COPY www/install /usr/share/centreon/www/install
COPY tmpl/install/sudoersCentreonEngine /etc/sudoers.d/centreon
RUN sed -i 's/@CENTREON_GROUP@/centreon/g' /etc/sudoers.d/centreon

# Static sources.
COPY tmpl/install/centreon.cron /etc/cron.d/centreon
COPY tmpl/install/centstorage.cron /etc/cron.d/centstorage
COPY cron /usr/share/centreon/cron
RUN chmod a+x /usr/share/centreon/cron/* && sed -i 's#@CENTREON_ETC@#/etc/centreon#g' /usr/share/centreon/cron/*
COPY www/sounds /usr/share/centreon/www/sounds
COPY www/img /usr/share/centreon/www/img
COPY www/widgets /usr/share/centreon/www/widgets
COPY www/modules /usr/share/centreon/www/modules
COPY lib /usr/share/centreon/lib
COPY www/index.php /usr/share/centreon/www/index.php
COPY www/main.php /usr/share/centreon/www/main.php
COPY www/Themes /usr/share/centreon/www/Themes
COPY www/lib /usr/share/centreon/www/lib
COPY www/include /usr/share/centreon/www/include
COPY www/api /usr/share/centreon/www/api
COPY www/class /usr/share/centreon/www/class
COPY config /usr/share/centreon/config
COPY src /usr/share/centreon/src
RUN sed -i 's/@PHP_BIN@/\/usr\/bin\/php/g' /usr/share/centreon/bin/console
RUN su - apache -s /bin/bash -c "/usr/share/centreon/bin/console cache:clear"
