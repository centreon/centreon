includes:
    - ../tools/phpstan/config/common.neon

# custom rules added only for the src/Core directory
rules:
    - Tools\PhpStan\CustomRules\MiscRules\StringBackquotesCustomRule
    - Tools\PhpStan\CustomRules\ArchitectureRules\DomainCallNamespacesCustomRule
    - Tools\PhpStan\CustomRules\RepositoryRules\RepositoryImplementsInterfaceCustomRule

parameters:
    level: 8
    paths:
        - src/Core
    ignoreErrors:

        - # [CENTREON-RULE]: (RepositoryNameCustomRule) Repository name must start with data storage prefix, which may be followed by 'Read' or 'Write' and context mention.
            reportUnmatched: false
            message: '#RepositoryNameCustomRule#'
            paths:
                - src/Core/Common/Infrastructure/Repository/AbstractRepositoryRDB.php
                - src/Core/Common/Infrastructure/Repository/DatabaseRepositoryManager.php
                - src/Core/Notification/Infrastructure/Repository/NotificationResourceRepositoryProvider.php

        - # [CENTREON-RULE]: (RepositoryInterfaceNameCustomRule) At least one Interface name must start with 'Read' or 'Write' and end with 'RepositoryInterface'.
            reportUnmatched: false
            message: '#RepositoryInterfaceNameCustomRule#'
            paths:
                - src/Core/Common/Infrastructure/Repository/DatabaseRepositoryManager.php
                - src/Core/Notification/Infrastructure/Repository/NotificationResourceRepositoryProvider.php

        - # Strict comparison using !== between 'VMWARE_V6' and 'VMWARE_V6' will always evaluate to false.
            reportUnmatched: false
            message: "#Strict comparison using !== between 'VMWARE_V6' and 'VMWARE_V6' will always evaluate to false.#"
            paths:
                - src/Core/AdditionalConnectorConfiguration/Application/UseCase/UpdateAcc/Validator.php

        - # [CENTREON-RULE] Our try catch block logging rule cannot handle nested try catch.
            reportUnmatched: false
            message: '#Exception thrown in UseCase should be in a try catch block, and must be caught.#'
            paths:
                - src/Core/Host/Application/UseCase/AddHost/AddHost.php
                - src/Core/HostTemplate/Application/UseCase/AddHostTemplate/AddHostTemplate.php
                - src/Core/Notification/Application/UseCase/AddNotification/AddNotification.php
                - src/Core/Notification/Application/UseCase/UpdateNotification/UpdateNotification.php
                - src/Core/Service/Application/UseCase/DeleteService/DeleteService.php
                - src/Core/ResourceAccess/Application/UseCase/AddRule/AddRule.php

        - # [CENTREON-RULE]: The class is extended or mocked. MUST be used only as a baseline.
            reportUnmatched: false
            message: '#Class [\\\w]+ must be final.#'
            paths:
                - src/Core/Application/Common/UseCase/AbstractResponse.php  # <- BUG which need to be fixed in custom Rules
                - src/Core/Application/Common/UseCase/ErrorResponse.php
                - src/Core/Application/Common/UseCase/ForbiddenResponse.php
                - src/Core/Application/Common/UseCase/UnauthorizedResponse.php
                - src/Core/Application/Configuration/User/UseCase/FindUsers/FindUsers.php
                - src/Core/Contact/Application/UseCase/FindContactGroups/FindContactGroups.php
                - src/Core/Contact/Application/UseCase/FindContactTemplates/FindContactTemplates.php
                - src/Core/Security/AccessGroup/Application/UseCase/FindLocalUserAccessGroups/FindLocalUserAccessGroups.php
                - src/Core/Security/Authentication/Application/UseCase/LogoutSession/LogoutSession.php
                - src/Core/Security/ProviderConfiguration/Application/Local/UseCase/FindConfiguration/FindConfiguration.php
                - src/Core/Security/ProviderConfiguration/Application/Local/UseCase/UpdateConfiguration/UpdateConfiguration.php
                - src/Core/Security/ProviderConfiguration/Application/OpenId/UseCase/FindOpenIdConfiguration/FindOpenIdConfiguration.php
                - src/Core/Security/ProviderConfiguration/Application/OpenId/UseCase/UpdateOpenIdConfiguration/UpdateOpenIdConfiguration.php
                - src/Core/Security/ProviderConfiguration/Application/WebSSO/UseCase/FindWebSSOConfiguration/FindWebSSOConfiguration.php
                - src/Core/Security/ProviderConfiguration/Application/WebSSO/UseCase/UpdateWebSSOConfiguration/UpdateWebSSOConfiguration.php
                - src/Core/Security/User/Application/UseCase/RenewPassword/RenewPassword.php
                - src/Core/Tag/RealTime/Application/UseCase/FindTag/FindTagResponse.php
                - src/Core/Media/Application/UseCase/AddMedia/AddMedia.php
                - src/Core/Media/Application/UseCase/MigrateAllMedias/MigrateAllMedias.php
                - src/Core/Command/Application/UseCase/MigrateAllCommands/MigrateAllCommands.php

          # ======= To fix this rule that block the development (TO CLEAN) =======
          # ðŸ‘‡ðŸ‘‡ Software architecture problem MUST be fixed !!! Only here as a baseline ðŸ‘‡ðŸ‘‡

        - # [CENTREON-RULE]: Domain must not call Application or Infrastructure namespaces.
            reportUnmatched: false
            message: '#Domain must not call Application or Infrastructure namespaces#'
            paths:
                - src/Core/Security/Authentication/Domain/Provider/OpenIdProvider.php
                - src/Core/Security/ProviderConfiguration/Domain/SecurityAccess/SecurityAccessInterface.php
                - src/Core/Security/User/Domain/Model/UserPasswordFactory.php

        - # [CENTREON-RULE]: The interface is not in the right namespace.
            reportUnmatched: false
            message: '#Repositories must implement an Interface defined in Application layer.#'
            paths:
                - src/Core/Security/ProviderConfiguration/Infrastructure/Repository/HttpReadAttributePathRepository.php

        - # [CENTREON-RULE]: (RepositoryNameValidationByInterfaceCustomRule) Repository name should match the implemented Interface name with exception of data storage prefix and 'Interface' mention.
            reportUnmatched: false
            message: '#RepositoryNameValidationByInterfaceCustomRule#'
            paths:
                - src/Core/Broker/Infrastructure/Repository/FileBrokerRepository.php
                - src/Core/Common/Infrastructure/Repository/DatabaseRepositoryManager.php
                - src/Core/Notification/Infrastructure/Repository/DbHostGroupResourceRepository.php
                - src/Core/Notification/Infrastructure/Repository/DbServiceGroupResourceRepository.php
                - src/Core/Notification/Infrastructure/Repository/NotificationResourceRepositoryProvider.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteHostCategoryRepository.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteHostGroupRepository.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteHostRepository.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteMetaServiceRepository.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteServiceCategoryRepository.php
                - src/Core/ResourceAccess/Infrastructure/Repository/Dataset/DbWriteServiceGroupRepository.php
                - src/Core/Security/Authentication/Infrastructure/Repository/DbReadTokenRepositoryInterface.php

        - # Problem : block usage of Value Object.
          # Unsafe usage of new static().
            reportUnmatched: false
            message: '#Unsafe usage of new static#'
            paths:
                - src/Core/Common/Domain/ValueObject

